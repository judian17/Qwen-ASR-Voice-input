[[English]](README.md)

# AI 语音输入法 (Yinput)

## 项目简介

这是一个基于 Windows 的 AI 语音输入法工具，通过实时语音识别（ASR）将你说的话转换成文字，并可选地通过大语言模型（LLM）进行润色、翻译或问答，最后将结果输入到当前焦点的任何应用程序中。

项目参考了来源于手机端的 [BiBi-Keyboard](https://github.com/BryceWG/BiBi-Keyboard)，因没找到类似的PC端项目故尝试自己使用AI实现。

本程序为 PC 端实现，采用 Python 编写，使用 wxPython 构建图形界面，底层通过 Win32 API 模拟键盘输入。

![项目界面](assets/example1.png)

![项目界面](assets/example2.png)

**核心特性**：
- **实时语音识别**：接入阿里云 DashScope 的实时 ASR 服务，支持流式识别，低延迟，支持中文（普通话、四川话、闽南语、吴语）、粤语、英语、日语、德语、韩语、俄语、法语、葡萄牙语、阿拉伯语、意大利语、西班牙语、印地语、印尼语、泰语、土耳其语、乌克兰语、越南语、捷克语、丹麦语、菲律宾语、芬兰语、冰岛语、马来语、挪威语、波兰语、瑞典语
- **AI 后处理**：内置 OpenAI 兼容接口，可连接 Qwen、DeepSeek、ChatGPT 等大模型，对识别结果进行润色、翻译、问答等处理。
- **灵活触发**：支持按键（F1-F12）或鼠标侧键（X1/X2）触发，提供长按（HOLD）和点按（TOGGLE）两种模式。
- **智能超时**：录音过程中若长时间无语音输入，自动停止录音，避免 API 持续计费。
- **模板系统**：可自定义多个 AI 处理模板，快速切换不同任务（如“语音润色”、“中译英”、“AI 问答”）。
- **跨应用输入**：通过 Win32 注入或剪贴板粘贴方式将文本输入到任意窗口。

## 功能特点

- **实时语音转文字**：采用阿里云 Qwen ASR 实时流式识别，边说边转。
- **AI 文本处理**：可选启用 LLM，对识别结果进行二次加工（去语气词、纠错、翻译、问答等）。
- **多种触发方式**：
  - 键盘触发：F1~F12 功能键（默认 F2）
  - 鼠标触发：侧键 MouseX1 / MouseX2
- **两种录音模式**：
  - **HOLD（长按）**：按住触发键开始录音，松开键结束录音并输出结果。
  - **TOGGLE（点按）**：按一次开始录音，再按一次结束录音；期间按设置的断句间隔自动分句。
- **自动停止保护**：在 TOGGLE 模式下，若设定时间内无语音活动，自动停止录音，防止忘记关闭导致费用损失。
- **模板管理**：可添加、删除、重命名 AI 处理模板，每个模板包含系统提示词和用户前缀。
- **配置持久化**：所有设置保存在 `config.ini` 中，重启后自动加载。
- **适配微信**：针对微信输入框的 bug 提供“粘贴上屏”选项，避免首字符被替换为标点。
- **设备选择**：可指定麦克风设备，默认使用系统默认设备。

## 快速开始

### 环境要求

- **操作系统**：Windows 10/11（依赖 Win32 API）
- **Python**：3.7 以上（本发行版已内置 Python 3.12，无需额外安装）
- **依赖包**：已包含在 `requirements.txt` 中，可通过 `pip install -r requirements.txt` 安装。

### 下载与运行

1. **下载项目**：从发布页面或代码仓库下载整个文件夹。
2. **获取 API 密钥**：
   - 前往 [阿里云 DashScope 控制台](https://bailian.console.aliyun.com/?tab=doc#/doc/?type=model&url=2989727) 开通实时语音识别服务，获取 API Key。
   - 如需使用 LLM 功能，可在同一控制台获取大模型 API Key（可与 ASR 相同）。
3. **首次运行**：
   - 执行 `python voice_ime.py`，程序将自动启动图形界面。
   - 在界面中填写 ASR Key、LLM Key 等配置，点击“保存配置并重启服务”。
4. **开始使用**：
   - 按下设定的触发键（默认 F2）开始说话，松开（HOLD 模式）或再次按下（TOGGLE 模式）结束录音。
   - 识别结果将自动输入到当前焦点窗口。

### 配置文件说明

程序首次运行后会在同级目录生成 `config.ini`，其中包含所有可调参数。你可以直接编辑该文件，或在图形界面中修改并保存。

关键配置项：
- `asr_api_key`：阿里云实时 ASR 的 API Key。
- `asr_url`：ASR 服务地址（中国大陆使用 `wss://dashscope.aliyuncs.com/api-ws/v1/realtime`，海外使用 `wss://dashscope-intl.aliyuncs.com/api-ws/v1/realtime`）。
- `asr_model`：ASR 模型名称，默认为 `qwen3-asr-flash-realtime`。
- `llm_api_key`：大模型 API Key。
- `llm_base_url`：OpenAI 兼容接口地址（Qwen 北京：`https://dashscope.aliyuncs.com/compatible-mode/v1`，新加坡：`https://dashscope-intl.aliyuncs.com/compatible-mode/v1`）。
- `llm_model`：大模型名称，如 `qwen-plus`、`qwen-turbo`。
- `trigger_key`：触发键，可选 `F1`~`F12`、`MouseX1`、`MouseX2`。
- `input_mode`：录音模式，`HOLD` 或 `TOGGLE`。
- `auto_stop_timeout`：自动停止超时（秒），0 表示禁用。
- `use_paste`：是否使用粘贴上屏（推荐微信用户开启）。

## 详细配置指南

### 1. ASR 配置

- **API Key 获取**：
  1. 登录 [阿里云 DashScope 控制台](https://bailian.console.aliyun.com/)。
  2. 开通“实时语音识别”服务。
  3. 在 [API Key 管理页面](https://help.aliyun.com/zh/model-studio/get-api-key) 创建 Key。
- **服务地址**：
  - 中国大陆用户建议使用北京服务器，价格更低、延迟更小。
  - 若网络环境允许，也可使用新加坡服务器（价格贵约一倍）。
- **模型选择**：目前推荐 `qwen3-asr-flash-realtime`，在速度与准确率之间取得良好平衡。

### 2. LLM 配置

- **兼容接口**：程序使用 OpenAI SDK，因此任何提供 OpenAI 兼容接口的模型均可使用。
- **推荐模型**：
  - **Qwen-plus**：性价比较高，适合多数场景。
  - **Qwen-turbo**：价格更便宜，响应更快，适合简单任务。
  - 其他模型：DeepSeek、ChatGPT 等，只需更改 `llm_base_url` 和 `llm_model` 即可。
- **地址说明**：
  - 北京：`https://dashscope.aliyuncs.com/compatible-mode/v1`
  - 新加坡：`https://dashscope-intl.aliyuncs.com/compatible-mode/v1`

### 3. 触发与模式

- **触发键**：
  - 普通字母数字键可能被输入框捕获，因此建议使用功能键（F1~F12）或鼠标侧键。
  - 鼠标侧键对应 `MouseX1`（前进）、`MouseX2`（后退），注意大小写。
- **录音模式**：
  - **长按**：适合需要控制说话时机的场景，如输入一段完整的话。
  - **点按**：适合长时间连续语音，如会议记录、实时翻译；期间会按“断句间隔”自动分割句子。
- **断句间隔**：在 GUI 中用滑块设置（单位毫秒），控制语音停顿多久后视为一句话结束。建议 500~1500 ms。

### 4. AI 模板配置

模板决定了 LLM 如何处理你的语音文本。每个模板包含：

- **名称**：用于在下拉列表中显示。
- **系统提示词**：定义模型的角色和任务，例如“你是一个语音输入助手，去除语气词、修正错别字，只输出纯文本”。
- **用户前缀**：在用户输入前添加的前缀，可留空。例如“请翻译：”会让模型知道后续内容是待翻译文本。

程序内置三个模板：
1. **语音润色（默认）**：去除语气词、修正错别字，输出干净文本。
2. **中译英**：将中文语音翻译成英文。
3. **AI 问答**：简短回答用户问题。

你可以通过界面上的“+”、“-”、“重命名”按钮管理模板。

### 5. 高级选项

- **麦克风选择**：如果你的电脑有多个录音设备，可在下拉列表中选择特定设备。
- **上屏方式**：
  - **默认注入**：通过 Win32 `SendInput` 模拟键盘输入，适用于大多数应用。
  - **粘贴上屏**：将结果复制到剪贴板，然后模拟 Ctrl+V 粘贴。适用于微信等存在首字符 bug 的应用。
- **无响应自动停止**：在 TOGGLE 模式下，若超过设定秒数没有收到任何语音转写结果，自动停止录音。防止忘记停止导致 API 持续计费。设为 0 可禁用此功能。

## 使用步骤

1. **启动程序**：双击 `启动.bat`，出现横向布局的主窗口。
2. **配置 API**：
   - 在左侧“API 与模型配置”区域填写 ASR Key、LLM Key 等信息。
   - 点击“保存配置并重启服务”使配置生效。
3. **选择模板**：在右侧“AI 模板配置”下拉框中选择需要的处理模式（如“语音润色”）。
4. **开始录音**：
   - 将焦点切换到需要输入文字的窗口（如记事本、Word、微信）。
   - 按下设定的触发键（默认 F2），界面状态指示器变为“正在录音...”。
   - 对着麦克风说话。
5. **结束录音**：
   - **HOLD 模式**：松开触发键，程序将识别结果发送给 AI 处理（若启用）并上屏。
   - **TOGGLE 模式**：再次按下触发键结束录音。
6. **查看日志**：主窗口右下方的日志框会显示识别进度、AI 处理结果和错误信息。

## 注意事项

- **API 费用**：使用阿里云 ASR 和 LLM 服务会产生费用，请留意用量。建议设置“自动停止超时”以避免忘记停止录音。
- **网络要求**：实时 ASR 需要稳定的网络连接，否则可能导致连接断开。
- **微信兼容性**：在微信中输入时，若发现首字符变为标点，请开启“使用粘贴”选项。
- **杀毒软件**：Win32 输入注入可能被某些安全软件误报，请将本程序加入白名单。
- **隐私安全**：语音数据会发送到阿里云服务器进行识别，请确保你信任该服务提供商。

## 常见问题

**Q：按下触发键没有反应？**  
A：请检查：
1. 是否已保存配置并重启服务。
2. 触发键是否被其他软件占用（如游戏快捷键）。
3. 若使用鼠标侧键，请确认设备驱动支持并正确设置为 `MouseX1`/`MouseX2`。

**Q：识别结果延迟很高？**  
A：可能是网络问题，尝试切换到距离更近的服务器（如北京）。同时确保麦克风质量良好，环境不过于嘈杂。

**Q：AI 处理没有生效？**  
A：检查：
1. “AI 处理”复选框是否勾选。
2. LLM Key 和 Base URL 是否正确。
3. 系统提示词是否适合当前任务（可参考内置模板）。

**Q：程序启动时报错“缺少模块”？**  
A：请运行 `pip install -r requirements.txt` 安装依赖。如果使用内置 Python，可双击 `启动.bat` 自动使用内置环境。

**Q：如何修改界面语言？**  
A：目前仅支持中文界面。如需英文界面，可自行修改源码中的字符串。

## 致谢

- 本项目灵感来源于 [BiBi-Keyboard](https://github.com/BryceWG/BiBi-Keyboard)，感谢 BryceWG 的开源作品。
- 实时语音识别基于阿里云 DashScope 的 Qwen ASR 服务。
- 图形界面使用 wxPython 构建。
- 输入监听使用 pynput，音频处理使用 PyAudio。

## 许可证

本项目基于 MIT 许可证开源。详见 [LICENSE](LICENSE) 文件（如有）。

---
**免责声明**：本程序为个人开发作品，与阿里云、OpenAI 等第三方服务提供商无关。使用过程中产生的任何费用、数据安全问题由用户自行承担。

**欢迎贡献**：如果你有改进建议或发现了 bug，欢迎提交 Issue 或 Pull Request。